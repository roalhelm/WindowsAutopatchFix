<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows Autopatch - Technical Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #24292e;
            background: #f6f8fa;
        }

        .header {
            background: linear-gradient(135deg, #0078d4 0%, #00bcf2 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .nav {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav a {
            padding: 0.5rem 1.5rem;
            background: #0078d4;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .nav a:hover {
            background: #005a9e;
        }

        .section {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #0078d4;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid #0078d4;
            font-size: 1.8rem;
        }

        .section h3 {
            color: #005a9e;
            margin: 1.5rem 0 1rem 0;
            font-size: 1.3rem;
        }

        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .component-card {
            background: #f6f8fa;
            border-left: 4px solid #0078d4;
            padding: 1.5rem;
            border-radius: 4px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .component-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .component-card h4 {
            color: #0078d4;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .component-card p {
            font-size: 0.95rem;
            color: #586069;
        }

        .diagram-container {
            margin: 2rem 0;
            text-align: center;
            background: #f6f8fa;
            padding: 2rem;
            border-radius: 8px;
        }

        .diagram-placeholder {
            background: white;
            border: 2px dashed #d1d5da;
            border-radius: 8px;
            padding: 3rem;
            margin: 1rem 0;
            color: #586069;
            font-style: italic;
        }

        .error-flow {
            background: #fff5f5;
            border-left: 4px solid #d73a49;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .error-flow h4 {
            color: #d73a49;
            margin-bottom: 0.5rem;
        }

        .error-flow ul {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
        }

        .error-flow li {
            margin: 0.5rem 0;
            color: #24292e;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0078d4;
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .info-box strong {
            color: #0078d4;
        }

        .reference-link {
            display: inline-block;
            margin: 0.25rem 0.5rem 0.25rem 0;
            padding: 0.25rem 0.75rem;
            background: #e7f3ff;
            color: #0078d4;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .reference-link:hover {
            background: #c7e0f4;
        }

        .footer {
            background: white;
            padding: 2rem;
            text-align: center;
            margin-top: 3rem;
            border-top: 1px solid #e1e4e8;
        }

        .footer a {
            color: #0078d4;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .component-grid {
                grid-template-columns: 1fr;
            }
            
            .nav {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîÑ Windows Autopatch</h1>
        <p>Technical Documentation & Architecture Guide</p>
    </div>

    <div class="container">
        <nav class="nav">
            <a href="#overview">Overview</a>
            <a href="#components">Components</a>
            <a href="#quality-updates">Quality Updates</a>
            <a href="#feature-updates">Feature Updates</a>
            <a href="#error-handling">Error Handling</a>
            <a href="https://github.com/roalhelm/WindowsUpdateFix" target="_blank">GitHub Repository</a>
        </nav>

        <!-- Overview Section -->
        <section id="overview" class="section">
            <h2>üìã Overview</h2>
            <p>Windows Autopatch is a cloud service that automates Windows updates and provides enterprise-grade update management through Microsoft Intune. It orchestrates both quality updates (monthly cumulative updates) and feature updates (OS upgrades) with intelligent ring-based deployments, readiness checks, and automated error handling.</p>
            
            <div class="info-box">
                <strong>üéØ Key Benefits:</strong> Automated patching, ring-based rollouts, built-in safeguards, telemetry-driven decisions, and reduced IT overhead.
            </div>
        </section>

        <!-- System Components Section -->
        <section id="components" class="section">
            <h2>üîß System Components</h2>
            
            <div class="component-grid">
                <div class="component-card">
                    <h4>ü§ñ Windows Autopatch Client Broker</h4>
                    <p>On-demand agent that performs device readiness checks and automated log collection. Manages communication between devices and Autopatch service. Installed as Win32 app since September 2024.</p>
                    <a href="https://learn.microsoft.com/en-us/windows/deployment/windows-autopatch/operate/windows-autopatch-client-broker" class="reference-link" target="_blank">üìö Documentation</a>
                </div>

                <div class="component-card">
                    <h4>‚¨ÜÔ∏è Client Broker Upgrader</h4>
                    <p>Invoked for feature upgrade orchestration (setup phases). Handles multi-phase feature releases with ring control during OS upgrades.</p>
                    <a href="https://learn.microsoft.com/en-us/windows/deployment/windows-autopatch/operate/windows-autopatch-feature-update-overview" class="reference-link" target="_blank">üìö Documentation</a>
                </div>

                <div class="component-card">
                    <h4>üîå Intune Management Extension (IME)</h4>
                    <p>Executes PowerShell scripts and Win32 app-based remediations. Used for readiness scripts and policy conflict remediation.</p>
                    <a href="https://learn.microsoft.com/en-us/mem/intune/apps/intune-management-extension" class="reference-link" target="_blank">üìö Documentation</a>
                </div>

                <div class="component-card">
                    <h4>üìã Windows Update for Business (WUfB)</h4>
                    <p>Controls update policies including offering, deferrals, deadlines, and ring rollout for quality and feature updates.</p>
                    <a href="https://learn.microsoft.com/en-us/windows/deployment/update/waas-manage-updates-wufb" class="reference-link" target="_blank">üìö Documentation</a>
                </div>

                <div class="component-card">
                    <h4>üì• Windows Update Agent (WUA)</h4>
                    <p>System component that downloads and installs update payloads. Handles installation workflows and status recording.</p>
                    <a href="https://learn.microsoft.com/en-us/windows/win32/wua_sdk/portal-client" class="reference-link" target="_blank">üìö Documentation</a>
                </div>

                <div class="component-card">
                    <h4>üåê Delivery Optimization (DO)</h4>
                    <p>Performs P2P and cache-assisted content distribution to reduce bandwidth during update downloads.</p>
                    <a href="https://learn.microsoft.com/en-us/windows/deployment/do/waas-delivery-optimization" class="reference-link" target="_blank">üìö Documentation</a>
                </div>

                <div class="component-card">
                    <h4>üìä Connected User Experiences & Telemetry</h4>
                    <p>Sends diagnostic/telemetry data used for Autopatch reporting and compliance signals.</p>
                    <a href="https://learn.microsoft.com/en-us/windows/privacy/configure-windows-diagnostic-data-in-your-organization" class="reference-link" target="_blank">üìö Documentation</a>
                </div>

                <div class="component-card">
                    <h4>‚òÅÔ∏è Autopatch Service (Cloud)</h4>
                    <p>Cloud orchestration in Intune that manages rings, release schedules, reporting, and readiness checks.</p>
                    <a href="https://learn.microsoft.com/en-us/windows/deployment/windows-autopatch/" class="reference-link" target="_blank">üìö Documentation</a>
                </div>

                <div class="component-card">
                    <h4>üõ†Ô∏è Windows Setup / SetupDiag</h4>
                    <p>Feature Update only: Setup.exe executes upgrade phases. SetupDiag analyzes failures automatically.</p>
                    <a href="https://learn.microsoft.com/en-us/windows/deployment/upgrade/setupdiag" class="reference-link" target="_blank">üìö Documentation</a>
                </div>
            </div>

            <div class="info-box">
                <strong>üìù Note:</strong> LTSC devices are managed for quality updates only; feature updates aren't offered via Autopatch/WU client policies.
            </div>
        </section>

        <!-- Quality Updates Section -->
        <section id="quality-updates" class="section">
            <h2>üì¶ Quality Update Process</h2>
            <p>Monthly cumulative updates that include security fixes, bug fixes, and improvements. Deployed through ring-based rollouts with automated monitoring.</p>

            <div class="diagram-container">
                <h3>Quality Update Flow</h3>
                <div class="diagram-placeholder">
                    <p>üñºÔ∏è Diagram Placeholder - Quality Update Process</p>
                    <p style="font-size: 0.9rem; margin-top: 1rem;">
                        Autopatch Service ‚Üí Device Assignment/Rings ‚Üí IME & Readiness ‚Üí WUA Offer ‚Üí 
                        Client Broker Coordinates ‚Üí DO Assists Download ‚Üí Install ‚Üí Telemetry Reporting
                    </p>
                </div>
                <p style="margin-top: 1rem; color: #586069; font-size: 0.95rem;">
                    <em>Add your custom diagram image here by placing it in the docs/images/ folder</em>
                </p>
            </div>

            <h3>Update Rings</h3>
            <div class="component-grid">
                <div class="component-card">
                    <h4>üîµ Test Ring</h4>
                    <p>Initial deployment to pilot devices for validation. Receives updates first (Day 0-1).</p>
                </div>
                <div class="component-card">
                    <h4>üü¢ First Ring</h4>
                    <p>Broader deployment after Test ring validation. Typically Day 1-6.</p>
                </div>
                <div class="component-card">
                    <h4>üü° Fast Ring</h4>
                    <p>Accelerated deployment for early adopters. Day 6+.</p>
                </div>
                <div class="component-card">
                    <h4>üü† Broad Ring</h4>
                    <p>General deployment to majority of devices. Day 9+.</p>
                </div>
            </div>
        </section>

        <!-- Feature Updates Section -->
        <section id="feature-updates" class="section">
            <h2>üöÄ Feature Update Process</h2>
            <p>Major OS version upgrades (e.g., 22H2 ‚Üí 24H2) with multi-phase release strategy. Includes comprehensive pre-checks, setup orchestration, and automated rollback capabilities.</p>

            <div class="diagram-container">
                <h3>Feature Update Flow</h3>
                <div class="diagram-placeholder">
                    <p>üñºÔ∏è Diagram Placeholder - Feature Update Process</p>
                    <p style="font-size: 0.9rem; margin-top: 1rem;">
                        Readiness Checks ‚Üí Client Broker Upgrader ‚Üí Windows Setup Phases ‚Üí 
                        Downlevel ‚Üí SafeOS ‚Üí First Boot ‚Üí Second Boot ‚Üí Telemetry & Compliance
                    </p>
                </div>
                <p style="margin-top: 1rem; color: #586069; font-size: 0.95rem;">
                    <em>Add your custom diagram image here by placing it in the docs/images/ folder</em>
                </p>
            </div>

            <h3>Setup Phases</h3>
            <div class="component-grid">
                <div class="component-card">
                    <h4>1Ô∏è‚É£ Downlevel Phase</h4>
                    <p>Pre-installation checks and setup preparation in current OS.</p>
                </div>
                <div class="component-card">
                    <h4>2Ô∏è‚É£ SafeOS Phase</h4>
                    <p>Windows PE environment where OS files are applied.</p>
                </div>
                <div class="component-card">
                    <h4>3Ô∏è‚É£ First Boot</h4>
                    <p>Initial boot into new OS, device configuration begins.</p>
                </div>
                <div class="component-card">
                    <h4>4Ô∏è‚É£ Second Boot</h4>
                    <p>Final configuration and user profile migration.</p>
                </div>
            </div>
        </section>

        <!-- Error Handling Section -->
        <section id="error-handling" class="section">
            <h2>‚ö†Ô∏è Error Handling & Resolution</h2>
            
            <h3>Quality Update Errors</h3>
            
            <div class="error-flow">
                <h4>‚ùå Device Not Ready</h4>
                <ul>
                    <li><strong>Detection:</strong> Device Readiness reports show causes</li>
                    <li><strong>Remediation:</strong> IME scripts remove GPO/ConfigMgr conflicts</li>
                    <li><strong>Action:</strong> Ensure recent Intune check-in</li>
                </ul>
            </div>

            <div class="error-flow">
                <h4>‚ùå Policy Conflicts (WUfB/GPO/ConfigMgr)</h4>
                <ul>
                    <li><strong>Detection:</strong> Registry checks for conflicting policies</li>
                    <li><strong>Remediation:</strong> Automated scripts via Intune (IME)</li>
                    <li><strong>Common:</strong> WUServer, UseWUServer, DoNotConnectToWindowsUpdateInternetLocations</li>
                </ul>
            </div>

            <div class="error-flow">
                <h4>‚ùå Network/Delivery Optimization Issues</h4>
                <ul>
                    <li><strong>Fallback:</strong> DO falls back to HTTP source</li>
                    <li><strong>Verify:</strong> Endpoints/ports and proxy bypass for DO service</li>
                    <li><strong>Check:</strong> Firewall rules for DO P2P traffic</li>
                </ul>
            </div>

            <div class="error-flow">
                <h4>‚ùå WUA Download/Installation Errors</h4>
                <ul>
                    <li><strong>Inspect:</strong> WindowsUpdateClient event logs</li>
                    <li><strong>Retry:</strong> Autopatch ring schedule handles retries</li>
                    <li><strong>Pause:</strong> Release can be paused if necessary</li>
                </ul>
            </div>

            <h3>Feature Update Errors</h3>
            
            <div class="error-flow">
                <h4>‚ùå Pre-check/Readiness Failure</h4>
                <ul>
                    <li><strong>Causes:</strong> Hardware incompatibility, insufficient storage, BitLocker policy</li>
                    <li><strong>Status:</strong> Autopatch marks device as "Not Ready"</li>
                    <li><strong>Action:</strong> Remediate issues and re-evaluate</li>
                </ul>
            </div>

            <div class="error-flow">
                <h4>‚ùå Setup Phase Failure</h4>
                <ul>
                    <li><strong>Detection:</strong> SetupDiag runs automatically to identify root cause</li>
                    <li><strong>Common Issues:</strong> EFI/system partition conflicts, driver incompatibilities</li>
                    <li><strong>Action:</strong> Review SetupDiagResults.xml and Panther logs</li>
                </ul>
            </div>

            <div class="error-flow">
                <h4>‚ùå Automatic Rollback</h4>
                <ul>
                    <li><strong>Trigger:</strong> Fatal error during setup phases</li>
                    <li><strong>Result:</strong> Windows Setup reverts to previous OS version</li>
                    <li><strong>Analysis:</strong> Review SetupDiag output and retry after fix</li>
                </ul>
            </div>

            <div class="error-flow">
                <h4>‚ùå Autopatch Pause / Safeguard Holds</h4>
                <ul>
                    <li><strong>Reason:</strong> Service pauses rings based on telemetry signals</li>
                    <li><strong>Action:</strong> Hold content until Microsoft publishes mitigations</li>
                    <li><strong>Status:</strong> Monitor release status in Autopatch reports</li>
                </ul>
            </div>

            <div class="error-flow">
                <h4>‚ùå Support Log Collection</h4>
                <ul>
                    <li><strong>Method:</strong> Client Broker enables automated log collection</li>
                    <li><strong>Access:</strong> File support request via Intune's Help & Support</li>
                    <li><strong>Logs:</strong> Comprehensive diagnostics for Microsoft support</li>
                </ul>
            </div>
        </section>

        <!-- Best Practices Section -->
        <section class="section">
            <h2>üí° Best Practices for UEM Teams</h2>
            
            <div class="info-box">
                <strong>‚úÖ Feature Update Rollouts (24H2+):</strong>
                <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
                    <li>Use multi-phase releases with Device Readiness reports</li>
                    <li>Add IME remediation for common blockers (legacy WU settings, storage thresholds)</li>
                    <li>Pre-empt failures by addressing readiness issues before deployment</li>
                </ul>
            </div>

            <div class="info-box">
                <strong>‚úÖ Client Broker Deployment:</strong>
                <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
                    <li>Deploy tenant-wide as Win32 app for reliable installation</li>
                    <li>Verify installation within 30-60 minutes after Autopatch enrollment</li>
                    <li>Monitor broker process and service health regularly</li>
                </ul>
            </div>

            <div class="info-box">
                <strong>‚úÖ Policy Conflicts Prevention:</strong>
                <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
                    <li>Remove ConfigMgr Software Update client settings for Autopatch devices</li>
                    <li>Clear WSUS registry artifacts (WUServer, UseWUServer)</li>
                    <li>Implement proactive remediation scripts for drift detection</li>
                </ul>
            </div>

            <div class="info-box">
                <strong>‚úÖ Monitoring & Reporting:</strong>
                <ul style="margin-top: 0.5rem; margin-left: 1.5rem;">
                    <li>Review Autopatch Device Readiness reports weekly</li>
                    <li>Monitor quality and feature update compliance dashboards</li>
                    <li>Track error rates and implement targeted remediations</li>
                </ul>
            </div>
        </section>

        <!-- Resources Section -->
        <section class="section">
            <h2>üìö Additional Resources</h2>
            
            <h3>Official Documentation</h3>
            <a href="https://learn.microsoft.com/en-us/windows/deployment/windows-autopatch/" class="reference-link" target="_blank">Windows Autopatch Overview</a>
            <a href="https://learn.microsoft.com/en-us/windows/deployment/windows-autopatch/operate/windows-autopatch-groups-windows-quality-update-overview" class="reference-link" target="_blank">Quality Update Management</a>
            <a href="https://learn.microsoft.com/en-us/windows/deployment/windows-autopatch/operate/windows-autopatch-feature-update-overview" class="reference-link" target="_blank">Feature Update Management</a>
            <a href="https://learn.microsoft.com/en-us/windows/deployment/windows-autopatch/references/windows-autopatch-conflicting-configurations" class="reference-link" target="_blank">Conflicting Configurations</a>
            
            <h3>Tools & Scripts</h3>
            <a href="https://github.com/roalhelm/WindowsUpdateFix" class="reference-link" target="_blank">Windows Update Fix Repository</a>
            <a href="https://github.com/roalhelm/WindowsUpdateFix/blob/main/README.md" class="reference-link" target="_blank">Proactive Remediation Documentation</a>
            <a href="https://learn.microsoft.com/en-us/windows/deployment/upgrade/setupdiag" class="reference-link" target="_blank">SetupDiag Tool</a>
        </section>
    </div>

    <footer class="footer">
        <p>Created by <a href="https://github.com/roalhelm" target="_blank">Ronny Alhelm</a> | 
        <a href="https://github.com/roalhelm/WindowsUpdateFix" target="_blank">View on GitHub</a></p>
        <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #586069;">
            Windows Autopatch Technical Documentation ¬© 2025
        </p>
    </footer>
</body>
</html>